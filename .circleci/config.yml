version: 2.1

jobs:
  basic-build-and-test:
    docker:
      - image: cimg/base:stable  # Basic CircleCI image

    steps:
      # Step 1: Checkout the code from the repository
      - checkout

      # Step 2: List all files to confirm checkout
      - run:
          name: List All Files in Root
          command: ls -laR
          # Recursively list all files to verify the structure after checkout

      # Step 3: Display Environment Variables
      - run:
          name: Display Environment Variables
          command: env
          # Lists all environment variables for debugging purposes

      # Step 4: Create a Sample File (for testing purposes)
      - run:
          name: Create Sample File
          command: |
            echo "This is a sample file created during the build" > sample.txt
            echo "File created at $(date)" >> sample.txt
            cat sample.txt
          # Creates a sample file and displays its contents

      # Step 5: Archive the File as an Artifact
      - persist_to_workspace:
          root: .
          paths:
            - sample.txt
          # Stores the `sample.txt` file as an artifact for later access

      # Step 6: Run Basic Tests
      - run:
          name: Run Basic Tests
          command: |
            # Test 1: Check if sample.txt exists
            if [ -f sample.txt ]; then
              echo "Test 1 Passed: sample.txt exists."
            else
              echo "Test 1 Failed: sample.txt does not exist."
              exit 1
            fi

            # Test 2: Check if sample.txt contains specific text
            if grep -q "This is a sample file" sample.txt; then
              echo "Test 2 Passed: sample.txt contains the expected text."
            else
              echo "Test 2 Failed: sample.txt does not contain the expected text."
              exit 1
            fi

            # Test 3: Check if sample.txt was created within the last minute
            creation_time=$(stat -c %Y sample.txt)
            current_time=$(date +%s)
            time_diff=$((current_time - creation_time))
            if [ "$time_diff" -le 60 ]; then
              echo "Test 3 Passed: sample.txt was created within the last minute."
            else
              echo "Test 3 Failed: sample.txt was not created recently."
              exit 1
            fi

      # Step 7: Print Disk Space and Memory Usage
      - run:
          name: Check System Resources
          command: |
            df -h
            free -m
          # Prints disk space and memory usage for debugging system resources

      # Step 8: Display CircleCI Job Information
      - run:
          name: Display Job Info
          command: |
            echo "Job ID: ${CIRCLE_WORKFLOW_ID}"
            echo "Job Number: ${CIRCLE_BUILD_NUM}"
            echo "Branch: ${CIRCLE_BRANCH}"
          # Prints CircleCI-specific environment variables for job tracking

workflows:
  build-and-test-workflow:
    jobs:
      - basic-build-and-test
